// Generated by CoffeeScript 1.6.3
(function() {
  var action, answer, generateMap, map, stepWithAction, view;

  map = new Map(40, 40);

  view = new ViewDescriber(map);

  generateMap = function() {
    var eX, eY, pX, pY, player, _, _i, _ref, _ref1;
    map.generate();
    _ref = map.randEmptySquare(), pX = _ref[0], pY = _ref[1];
    player = new PlayerObj(map, '@', pX, pY);
    map.addObject(player);
    for (_ = _i = 1; _i <= 10; _ = ++_i) {
      _ref1 = map.randEmptySquare(), eX = _ref1[0], eY = _ref1[1];
      map.addObject(new MonsterObj(map, MONSTERS["Keukegen"], eX, eY));
    }
    map.player = player;
    return player.computeFov();
  };

  stepWithAction = function(action) {
    var m, messages, player, _i, _len;
    player = map.player;
    player.action = action;
    while (action.canPerform(player)) {
      map.step();
      messages = view.step();
      for (_i = 0, _len = messages.length; _i < _len; _i++) {
        m = messages[_i];
        console.log(m);
      }
    }
    player.action = null;
    return map.print();
  };

  map.print();

  console.log(view.describe());

  while (true) {
    answer = readline.question('What is your action? ');
    action = parseAction(answer);
    if (typeof action === 'string') {
      console.log(action);
    } else {
      stepWithAction(action);
    }
  }

}).call(this);
